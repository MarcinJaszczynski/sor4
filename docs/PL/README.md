# Dokumentacja (PL) — sorv31events

To jest podstawowa polska dokumentacja projektu oraz krótki przewodnik po najważniejszych komponentach aplikacji.

## Cel projektu
System służy do zarządzania i prezentacji ofert wycieczek (EventTemplate). Aplikacja udostępnia frontend z listą ofert, szczegółami oferty oraz mechanizmami obliczania cen (wielowalutowo) i dostępności dla miejsc startowych.

## Najważniejsze komponenty
- `app/Http/Controllers/Front/FrontController.php` — kontrolery front-endowe: strony głównej, katalogu ofert (`/oferty`), partiali i widoków szczegółowych. Zawiera logikę filtrowania ofert, rozwiązywania `start_place_id`, paginacji i przygotowywania danych do widoków.
- `app/Services/EventTemplateCalculationEngine.php` — silnik kalkulacji cen szablonu: responsywny, zwraca szczegółowe wyliczenia walutowe (raw + final) dla każdego wariantu qty.
- `app/Services/UnifiedPriceCalculator.php` — adapter/normalizator wyników z silnika kalkulacyjnego; tworzy ujednoliconą postać cenową i (opcjonalnie) zapisuje je do bazy.
- `app/Services/PriceRoundingService.php` — pojedyncze źródło zasad zaokrąglania cen przed zapisaniem do bazy.

## Kilka praktycznych informacji
- Filtrowanie ofert po `start_place_id` jest realizowane na poziomie zapytań Eloquent (`whereHas('startingPlaceAvailabilities', ...)` oraz `whereHas('pricesPerPerson', ...)`) oraz dodatkowo zabezpieczone po mapowaniu kolekcji (defensive filter) aby uniknąć wyświetlania ofert bez lokalnej dostępności.
- Engine wyliczeń (`EventTemplateCalculationEngine`) jest teraz źródłem prawdy; `UnifiedPriceCalculator` otrzymuje dane z engine i nie fallbackuje już na stare wiersze DB.
- Rounding: ceny są zaokrąglane jednolicie w `PriceRoundingService` przy zapisie.

## Uruchamianie testów
Instalacja zależności i uruchomienie testów (w katalogu repo):
```bash
composer install
./vendor/bin/pest
```

## Jak dodać komentarze po polsku
1. Najpierw utwórz `/** ... */` docblock na początku pliku lub przed klasą/funkcją.
2. Trzymaj krótkie streszczenie celu klasy/metody (1-2 zdania), opcjonalnie opis parametrów i wartości zwracanej.
3. Używaj prostych słów i unikaj długich akapitów.

Przykład:
```php
/**
 * Usługa obliczająca ceny dla szablonu wydarzenia.
 * Zwraca tablicę z danymi surowymi i finalnymi dla każdej waluty.
 */
class EventTemplateCalculationEngine { ... }
```

## Propozycja kolejnych kroków
- Dodanie polskich docblocków do wszystkich klas w `app/` — można to zrobić iteracyjnie.
- Wprowadzenie prostego skryptu do skanowania brakujących docblocków (np. `php artisan make:doccheck` lub skrypt bash używający `php -l` i `grep`).

### Narzędzie pomocnicze
W katalogu `tools/` znajduje się prosty skrypt `add-docblocks.sh`, który raportuje pliki PHP w `app/` nieposiadające docblocka klasy w pierwszych 40 liniach. Użycie:

```bash
chmod +x tools/add-docblocks.sh
./tools/add-docblocks.sh
```

Skrypt jest heurystyczny i ma charakter pomocniczy — nie wstawia docblocków automatycznie, ale pokazuje listę plików, które warto uzupełnić.

---
Autogenerated documentation snapshot — uzupełnij zgodnie z potrzebami zespołu.
